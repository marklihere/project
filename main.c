#include "mytm4c123gh6pm.h"
#include "init.h"
#include "LCD.c"
#include <stdlib.h>

#define SSI_SR_RNE 0x00000004 // SSI Rx FIFO Not Empty
#define SSI_SR_TFE 0x00000001 // SSI Tx FIFO Empty
#define wxmax 0x5DD
#define wxmin 0x000
#define wymax 0x773
#define wymin 0x4D8
#define cyxmax 0xBA1
#define cyxmin 0x674
#define cyymax 0x7AA
#define cyymin 0x4DF
#define gxmax 0xFFF
#define gxmin 0xBC2
#define gymax 0x757
#define gymin 0x502
#define blxmax 0x48E
#define blxmin 0x000
#define blymax 0xBFB
#define blymin 0x78A
#define mgxmax 0xBA8
#define mgxmin 0x68E
#define mgymax 0xC03
#define mgymin 0x7A6
#define orxmax 0xFFF
#define orxmin 0xBA3
#define orymax 0xBFB
#define orymin 0x78F
#define yxmax 0x483
#define yxmin 0x000
#define yymax 0xFFF
#define yymin 0xC30
#define brxmax 0xBE7
#define brxmin 0x6A5
#define brymax 0xFFF
#define brymin 0xC30
#define rxmax 0xFFF
#define rxmin 0xBFF
#define rymax 0xFFF
#define rymin 0xC1F

// Globals
int prev_touch = 0;  // need this global so a simple touch still restores prev darkened push
int userPressedButton = 0;     // semaphore to synchronize ISR & Main thread

unsigned short sine_array[] = {0x800,0x940,0xa78,0xba1,0xcb3,0xda7,0xe78,0xf20,
0xf9b,0xfe6,0xfff,0xfe6,0xf9b,0xf20,0xe78,0xda7,
0xcb3,0xba1,0xa78,0x940,0x800,0x6bf,0x587,0x45e,
0x34c,0x258,0x187,0xdf,0x64,0x19,0x0,0x19,
0x64,0xdf,0x187,0x258,0x34c,0x45e,0x587,0x6bf};


// bigFont from class lab supplements
// adapted from : http://www.henningkarlsen.com/electronics/r_fonts.php
unsigned char BigFont[] ={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // <space>
0x00,0x00,0x00,0x00,0x07,0x00,0x0F,0x80,0x0F,0x80,0x0F,0x80,0x0F,0x80,0x0F,0x80,0x07,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x00,0x00,  // !
0x00,0x00,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x06,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // "
0x00,0x00,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x7F,0xFE,0x7F,0xFE,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x7F,0xFE,0x7F,0xFE,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x00,0x00,  // #
0x00,0x00,0x02,0x40,0x02,0x40,0x0F,0xF8,0x1F,0xF8,0x1A,0x40,0x1A,0x40,0x1F,0xF0,0x0F,0xF8,0x02,0x58,0x02,0x58,0x1F,0xF8,0x1F,0xF0,0x02,0x40,0x02,0x40,0x00,0x00,  // $
0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x10,0x0E,0x30,0x0E,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x70,0x0C,0x70,0x08,0x70,0x00,0x00,0x00,0x00,0x00,0x00,  // %
0x00,0x00,0x00,0x00,0x0F,0x00,0x19,0x80,0x19,0x80,0x19,0x80,0x0F,0x00,0x0F,0x08,0x0F,0x98,0x19,0xF8,0x18,0xF0,0x18,0xE0,0x19,0xF0,0x0F,0x98,0x00,0x00,0x00,0x00,  // &
0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // '
0x00,0x00,0x00,0x00,0x00,0xF0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x07,0x00,0x03,0x80,0x01,0xC0,0x00,0xF0,0x00,0x00,0x00,0x00,  // (
0x00,0x00,0x00,0x00,0x0F,0x00,0x03,0x80,0x01,0xC0,0x00,0xE0,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x0F,0x00,0x00,0x00,0x00,0x00,  // )
0x00,0x00,0x00,0x00,0x01,0x80,0x11,0x88,0x09,0x90,0x07,0xE0,0x07,0xE0,0x3F,0xFC,0x3F,0xFC,0x07,0xE0,0x07,0xE0,0x09,0x90,0x11,0x88,0x01,0x80,0x00,0x00,0x00,0x00,  // *
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x80,0x01,0x80,0x01,0x80,0x0F,0xF0,0x0F,0xF0,0x01,0x80,0x01,0x80,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // +
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x0E,0x00,0x00,0x00,  // ,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xF8,0x1F,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // -
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x00,0x00,0x00,0x00,  // .
0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x06,0x00,0x0E,0x00,0x1C,0x00,0x38,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,  // /

0x00,0x00,0x00,0x00,0x0F,0xF0,0x1C,0x38,0x1C,0x78,0x1C,0xF8,0x1C,0xF8,0x1D,0xB8,0x1D,0xB8,0x1F,0x38,0x1F,0x38,0x1E,0x38,0x1C,0x38,0x0F,0xF0,0x00,0x00,0x00,0x00,  // 0
0x00,0x00,0x00,0x00,0x01,0x80,0x01,0x80,0x03,0x80,0x1F,0x80,0x1F,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x1F,0xF0,0x00,0x00,0x00,0x00,  // 1
0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x70,0x1C,0x38,0x00,0x38,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x38,0x1C,0x38,0x1F,0xF8,0x00,0x00,0x00,0x00,  // 2
0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x70,0x1C,0x38,0x00,0x38,0x00,0x70,0x03,0xC0,0x03,0xC0,0x00,0x70,0x00,0x38,0x1C,0x38,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // 3
0x00,0x00,0x00,0x00,0x00,0xE0,0x01,0xE0,0x03,0xE0,0x06,0xE0,0x0C,0xE0,0x18,0xE0,0x1F,0xF8,0x1F,0xF8,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x03,0xF8,0x00,0x00,0x00,0x00,  // 4
0x00,0x00,0x00,0x00,0x1F,0xF8,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1F,0xE0,0x1F,0xF0,0x00,0x78,0x00,0x38,0x1C,0x38,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // 5
0x00,0x00,0x00,0x00,0x03,0xE0,0x07,0x00,0x0E,0x00,0x1C,0x00,0x1C,0x00,0x1F,0xF0,0x1F,0xF8,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x0F,0xF0,0x00,0x00,0x00,0x00,  // 6
0x00,0x00,0x00,0x00,0x1F,0xFC,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x00,0x1C,0x00,0x38,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x03,0x80,0x03,0x80,0x00,0x00,0x00,0x00,  // 7
0x00,0x00,0x00,0x00,0x0F,0xF0,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1F,0x38,0x07,0xE0,0x07,0xE0,0x1C,0xF8,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x0F,0xF0,0x00,0x00,0x00,0x00,  // 8
0x00,0x00,0x00,0x00,0x0F,0xF0,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1F,0xF8,0x0F,0xF8,0x00,0x38,0x00,0x38,0x00,0x70,0x00,0xE0,0x07,0xC0,0x00,0x00,0x00,0x00,  // 9
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x03,0x80,0x03,0x80,0x00,0x00,0x00,0x00,0x03,0x80,0x03,0x80,0x03,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // :
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x03,0x80,0x03,0x80,0x00,0x00,0x00,0x00,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // ;
0x00,0x00,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x00,0x1C,0x00,0x1C,0x00,0x0E,0x00,0x07,0x00,0x03,0x80,0x01,0xC0,0x00,0xE0,0x00,0x70,0x00,0x00,  // <
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xFC,0x3F,0xFC,0x00,0x00,0x00,0x00,0x3F,0xFC,0x3F,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // =
0x00,0x00,0x1C,0x00,0x0E,0x00,0x07,0x00,0x03,0x80,0x01,0xC0,0x00,0xE0,0x00,0x70,0x00,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x00,0x1C,0x00,0x00,0x00,  // >
0x00,0x00,0x03,0xC0,0x0F,0xF0,0x1E,0x78,0x18,0x38,0x00,0x38,0x00,0x70,0x00,0xE0,0x01,0xC0,0x01,0xC0,0x00,0x00,0x00,0x00,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x00,0x00,  // ?

0x00,0x00,0x0F,0xF8,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0xFC,0x1C,0xFC,0x1C,0xFC,0x1C,0xFC,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1F,0xF0,0x07,0xF8,0x00,0x00,  // @
0x00,0x00,0x00,0x00,0x03,0xC0,0x07,0xE0,0x0E,0x70,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1F,0xF8,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x00,0x00,0x00,0x00,  // A
0x00,0x00,0x00,0x00,0x1F,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0F,0xF0,0x0F,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x1F,0xF0,0x00,0x00,0x00,0x00,  // B
0x00,0x00,0x00,0x00,0x07,0xF0,0x0E,0x38,0x1C,0x38,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0x38,0x0E,0x38,0x07,0xF0,0x00,0x00,0x00,0x00,  // C
0x00,0x00,0x00,0x00,0x1F,0xE0,0x0E,0x70,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x70,0x1F,0xE0,0x00,0x00,0x00,0x00,  // D
0x00,0x00,0x00,0x00,0x1F,0xF8,0x0E,0x18,0x0E,0x08,0x0E,0x00,0x0E,0x30,0x0F,0xF0,0x0F,0xF0,0x0E,0x30,0x0E,0x00,0x0E,0x08,0x0E,0x18,0x1F,0xF8,0x00,0x00,0x00,0x00,  // E
0x00,0x00,0x00,0x00,0x1F,0xF8,0x0E,0x18,0x0E,0x08,0x0E,0x00,0x0E,0x30,0x0F,0xF0,0x0F,0xF0,0x0E,0x30,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,  // F
0x00,0x00,0x00,0x00,0x07,0xF0,0x0E,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x00,0x1C,0x00,0x1C,0x00,0x1C,0xF8,0x1C,0x38,0x1C,0x38,0x0E,0x38,0x07,0xF8,0x00,0x00,0x00,0x00,  // G
0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1F,0xF0,0x1F,0xF0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x00,0x00,0x00,0x00,  // H
0x00,0x00,0x00,0x00,0x0F,0xE0,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x0F,0xE0,0x00,0x00,0x00,0x00,  // I
0x00,0x00,0x00,0x00,0x01,0xFC,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x38,0x70,0x38,0x70,0x38,0x70,0x38,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // J
0x00,0x00,0x00,0x00,0x1E,0x38,0x0E,0x38,0x0E,0x70,0x0E,0xE0,0x0F,0xC0,0x0F,0x80,0x0F,0x80,0x0F,0xC0,0x0E,0xE0,0x0E,0x70,0x0E,0x38,0x1E,0x38,0x00,0x00,0x00,0x00,  // K
0x00,0x00,0x00,0x00,0x1F,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x08,0x0E,0x18,0x0E,0x38,0x1F,0xF8,0x00,0x00,0x00,0x00,  // L
0x00,0x00,0x00,0x00,0x1C,0x1C,0x1E,0x3C,0x1F,0x7C,0x1F,0xFC,0x1F,0xFC,0x1D,0xDC,0x1C,0x9C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x00,0x00,0x00,0x00,  // M
0x00,0x00,0x00,0x00,0x1C,0x1C,0x1C,0x1C,0x1E,0x1C,0x1F,0x1C,0x1F,0x9C,0x1D,0xDC,0x1C,0xFC,0x1C,0x7C,0x1C,0x3C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x00,0x00,0x00,0x00,  // N
0x00,0x00,0x00,0x00,0x03,0xE0,0x07,0xF0,0x0E,0x38,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x0E,0x38,0x07,0xF0,0x03,0xE0,0x00,0x00,0x00,0x00,  // O

0x00,0x00,0x00,0x00,0x1F,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0F,0xF0,0x0F,0xF0,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,  // P
0x00,0x00,0x00,0x00,0x03,0xE0,0x0F,0x78,0x0E,0x38,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x7C,0x1C,0xFC,0x0F,0xF8,0x0F,0xF8,0x00,0x38,0x00,0xFC,0x00,0x00,  // Q
0x00,0x00,0x00,0x00,0x1F,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0F,0xF0,0x0F,0xF0,0x0E,0x70,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x1E,0x38,0x00,0x00,0x00,0x00,  // R
0x00,0x00,0x00,0x00,0x0F,0xF0,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x00,0x0F,0xE0,0x07,0xF0,0x00,0x38,0x1C,0x38,0x1C,0x38,0x1C,0x38,0x0F,0xF0,0x00,0x00,0x00,0x00,  // S
0x00,0x00,0x00,0x00,0x1F,0xFC,0x19,0xCC,0x11,0xC4,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x07,0xF0,0x00,0x00,0x00,0x00,  // T
0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // U
0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0E,0xE0,0x07,0xC0,0x03,0x80,0x00,0x00,0x00,0x00,  // V
0x00,0x00,0x00,0x00,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x0F,0xF8,0x0F,0xF8,0x07,0x70,0x07,0x70,0x00,0x00,0x00,0x00,  // W
0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0E,0xE0,0x07,0xC0,0x03,0x80,0x03,0x80,0x07,0xC0,0x0E,0xE0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x00,0x00,0x00,0x00,  // X
0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0E,0xE0,0x07,0xC0,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x0F,0xE0,0x00,0x00,0x00,0x00,  // Y
0x00,0x00,0x00,0x00,0x1F,0xF8,0x1C,0x38,0x18,0x38,0x10,0x70,0x00,0xE0,0x01,0xC0,0x03,0x80,0x07,0x00,0x0E,0x08,0x1C,0x18,0x1C,0x38,0x1F,0xF8,0x00,0x00,0x00,0x00,  // Z
0x00,0x00,0x00,0x00,0x07,0xF0,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,  // [
0x00,0x00,0x00,0x00,0x10,0x00,0x18,0x00,0x1C,0x00,0x0E,0x00,0x07,0x00,0x03,0x80,0x01,0xC0,0x00,0xE0,0x00,0x70,0x00,0x38,0x00,0x1C,0x00,0x07,0x00,0x00,0x00,0x00,  // <backslash>
0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x07,0xF0,0x00,0x00,0x00,0x00,  // ]
0x00,0x00,0x01,0x80,0x03,0xC0,0x07,0xE0,0x0E,0x70,0x1C,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // ^
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0x7F,0xFF,  // _

0x00,0x00,0x00,0x00,0x1C,0x00,0x1C,0x00,0x07,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // `
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x70,0x00,0x70,0x0F,0xF0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xD8,0x00,0x00,0x00,0x00,  // a
0x00,0x00,0x00,0x00,0x1E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0F,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x1B,0xF0,0x00,0x00,0x00,0x00,  // b
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x70,0x1C,0x70,0x1C,0x00,0x1C,0x00,0x1C,0x70,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // c
0x00,0x00,0x00,0x00,0x00,0xF8,0x00,0x70,0x00,0x70,0x00,0x70,0x0F,0xF0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xD8,0x00,0x00,0x00,0x00,  // d
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x70,0x1C,0x70,0x1F,0xF0,0x1C,0x00,0x1C,0x70,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // e
0x00,0x00,0x00,0x00,0x03,0xE0,0x07,0x70,0x07,0x70,0x07,0x00,0x07,0x00,0x1F,0xE0,0x1F,0xE0,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x1F,0xC0,0x00,0x00,0x00,0x00,  // f
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xD8,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xF0,0x07,0xF0,0x00,0x70,0x1C,0x70,0x0F,0xE0,  // g
0x00,0x00,0x00,0x00,0x1E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0xF0,0x0F,0x38,0x0F,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x1E,0x38,0x00,0x00,0x00,0x00,  // h
0x00,0x00,0x00,0x00,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x00,0x00,0x0F,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x0F,0xF8,0x00,0x00,0x00,0x00,  // i
0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x00,0x03,0xF0,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x1C,0x70,0x0C,0xF0,0x07,0xE0,  // j
0x00,0x00,0x00,0x00,0x1E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x38,0x0E,0x70,0x0E,0xE0,0x0F,0xC0,0x0E,0xE0,0x0E,0x70,0x0E,0x38,0x1E,0x38,0x00,0x00,0x00,0x00,  // k
0x00,0x00,0x00,0x00,0x0F,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x0F,0xF8,0x00,0x00,0x00,0x00,  // l
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xF8,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x1C,0x9C,0x00,0x00,0x00,0x00,  // m
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xE0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x00,0x00,0x00,0x00,  // n
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // o

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1B,0xF0,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0F,0xF0,0x0E,0x00,0x0E,0x00,0x1F,0x00,  // p
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xB0,0x38,0xE0,0x38,0xE0,0x38,0xE0,0x38,0xE0,0x38,0xE0,0x1F,0xE0,0x00,0xE0,0x00,0xE0,0x01,0xF0,  // q
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0xF0,0x0F,0xF8,0x0F,0x38,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,  // r
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x1C,0x30,0x1C,0x30,0x0F,0x80,0x03,0xE0,0x18,0x70,0x18,0x70,0x0F,0xE0,0x00,0x00,0x00,0x00,  // s
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x03,0x00,0x07,0x00,0x1F,0xF0,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x70,0x07,0x70,0x03,0xE0,0x00,0x00,0x00,0x00,  // t
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0F,0xD8,0x00,0x00,0x00,0x00,  // u
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x1C,0x70,0x0E,0xE0,0x07,0xC0,0x03,0x80,0x00,0x00,0x00,0x00,  // v
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x9C,0x1C,0x9C,0x0F,0xF8,0x07,0x70,0x07,0x70,0x00,0x00,0x00,0x00,  // w
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0xE0,0x1C,0xE0,0x0F,0xC0,0x07,0x80,0x07,0x80,0x0F,0xC0,0x1C,0xE0,0x1C,0xE0,0x00,0x00,0x00,0x00,  // x
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x0E,0x38,0x07,0xF0,0x03,0xE0,0x00,0xE0,0x01,0xC0,0x1F,0x80,  // y
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xE0,0x18,0xE0,0x11,0xC0,0x03,0x80,0x07,0x00,0x0E,0x20,0x1C,0x60,0x1F,0xE0,0x00,0x00,0x00,0x00,  // z
0x00,0x00,0x00,0x00,0x01,0xF8,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x00,0x1C,0x00,0x1C,0x00,0x07,0x00,0x03,0x80,0x03,0x80,0x03,0x80,0x01,0xF8,0x00,0x00,0x00,0x00,  // {
0x00,0x00,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x00,0x00,  // |
0x00,0x00,0x00,0x00,0x1F,0x80,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x00,0xE0,0x00,0x38,0x00,0x38,0x00,0xE0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x1F,0x80,0x00,0x00,0x00,0x00,  // }
0x00,0x00,0x00,0x00,0x1F,0x1C,0x3B,0x9C,0x39,0xDC,0x38,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // ~
};

unsigned short xarray[100];
unsigned short yarray[100];
int xtotal = 0;
int ytotal = 0;
int touch = 0;

void mysetArea(unsigned short x1, unsigned short x2, unsigned short y1, unsigned short y2) {
  // Column Address Set 0x2A
	// columns range from 0 to 239
	mywriteCmd(0x2A);
	mywriteDat2(x1);
	mywriteDat2(x2);
	
	// Page Address Set 0x2B
	// pages range from 0 to 319
	mywriteCmd(0x2B);
	mywriteDat2(y1);
	mywriteDat2(y2);
}


void mywriteColor(unsigned short color) {
	int i;
	int cols;
	int rows;
	cols = 240;
	rows = 320;

  mywriteCmd(0x2C);
	for(i = 0; i < cols*rows; i++)
	  mywriteDat2(color);
}

void gameOverAnimate(void) {
  int i;
  int j;
	
for (j = 0; j < 150; j++) {
  mywriteCmd(0x28);
  for( i = 0; i < 20000; i++) { ;}
  mywriteCmd(0x21);
  for( i = 0; i < 20000; i++) { ;}
  mywriteCmd(0x29);
  for( i = 0; i < 20000; i++) { ;}
  mywriteCmd(0x20);
  for( i = 0; i < 20000; i++) { ;}
  }
}

// function to print a character on the screen 
void printChar (char c) {
  int i, x;
	
	mywriteCmd(0x2C);
  for(i = 0; i < 32; i++) {  // loops through 16 bytes (one character)
      
	// examines a single byte
	// '0' in Ascii is dec48
	// our offset is 16 for '0' 
	// so we subtract (dec)32
    for(x = 7; x >= 0; x--) {
       if (((BigFont[32*(c-32) + i] >> x) & 0x01) == 0x01) {
      //if (((0x0F >> x) & 0x01) == 0x01) {	  
    	  mywriteDat2(0xFFFF);  // writes 1 white pixel
      } else {
	      mywriteDat2(0x0000);  // writes 1 black pixel
      }
    }
  } //for
}
	

// write "High Score: "
void printHighScoreText(void) {
  mysetArea(0, 15, 0, 15);  // try drawing a character
  printChar('H');
  mysetArea(16, 31, 0, 15);  // try drawing a character
  printChar('i');
  mysetArea(32, 47, 0, 15);  // try drawing a character
  printChar('g');
  mysetArea(48, 63, 0, 15);  // try drawing a character
  printChar('h');
  mysetArea(64, 79, 0, 15);  // try drawing a character
  printChar(' ');
  mysetArea(80, 95, 0, 15);  // try drawing a character
  printChar('S');
  mysetArea(96, 111, 0, 15);  // try drawing a character
  printChar('c');
  mysetArea(112, 127, 0, 15);  // try drawing a character
  printChar('o');
  mysetArea(128, 143, 0, 15);  // try drawing a character
  printChar('r');
  mysetArea(144, 159, 0, 15);  // try drawing a character
  printChar('e');
  mysetArea(160, 175, 0, 15);  // try drawing a character
  printChar(':');
  mysetArea(176, 191, 0, 15);  // try drawing a character
  printChar(' ');
}

// print a high score
void printScore(int num) {
  int tens, ones;

  tens = num / 10;
  ones = num % 10;
  mysetArea(192, 207, 0, 15);  // tens digit
  printChar((char)tens + 48);
  mysetArea(208, 223, 0, 15);  // ones digit
  printChar((char)ones + 48);
}

/*void fillGreen(void) {

  mysetArea(67, 137, 128, 193);
  if (g==0)
		mywriteColor(green);
	else
		mywriteColor(black);
}

void fillRed(void) {
  mysetArea(67, 137, 45, 110);
	if (r==0)
	  mywriteColor(red);
	else
		mywriteColor(black);
}
void fillYellow(void) {
  mysetArea(67, 137, 211, 277);
	if (y==0)
  	mywriteColor(yellow);
	else
		mywriteColor(black);
}
*/
// Input: xtotal, ytotal
// output: 1-9
// returns the touch value of color being touched
unsigned int touched_color(int x, int y){
	int temp;
	if        (x > rxmin && x < rxmax && y > rymin && y < rymax) {
		temp = 9;  //9 is red
	} else if (x > yxmin && x < yxmax && y > yymin && y < yymax) {
		temp = 7;  //7 is yellow
	} else if (x > gxmin && x < gxmax && y > gymin && y < gymax) {
		temp = 3;  //3 is green
	} else if (xtotal > wxmin && xtotal < wxmax && ytotal > wymin && ytotal < wymax){
		temp = 1;  //1 is white
	} else if (xtotal > cyxmin && xtotal < cyxmax && ytotal > cyymin && ytotal < cyymax){
		temp = 2;	 
	} else if (xtotal > blxmin && xtotal < blxmax && ytotal > blymin && ytotal < blymax){
		temp = 4;
	} else if (xtotal > mgxmin && xtotal < mgxmax && ytotal > mgymin && ytotal < mgymax){
		temp = 5;
	} else if (xtotal > orxmin && xtotal < orxmax && ytotal > orymin && ytotal < orymax){
		temp = 6;	
	} else if (xtotal > brxmin && xtotal < brxmax && ytotal > brymin && ytotal < brymax){
		temp = 8;
	}else
		temp = 0;

	return temp;
}

void black1(int t){
	switch(t){
			case 1:
				mysetArea(5, 75, 85, 155);
				mywriteColor(black);
				break;
			case 2:
				mysetArea(86, 155, 85, 155);
				mywriteColor(black);			 
				break;
			case 3:
				mysetArea(165, 235, 85, 155);
				mywriteColor(black);
				break;
			case 4:
				mysetArea(5, 75, 165, 235);
				mywriteColor(black);
				break;
			case 5:
				mysetArea(86, 155, 165, 235);
				mywriteColor(black);
				break;
			case 6:
				mysetArea(165, 235, 165, 235);
				mywriteColor(black);
				break;
			case 7:
				mysetArea(5, 75, 245, 315);
				mywriteColor(black);
				break;
			case 8:
				mysetArea(86, 155, 245, 315);
				mywriteColor(black);
				break;
			case 9:
				mysetArea(165, 235, 245, 315);
				mywriteColor(black);
				break;
				
		}
}

void fill(int t){
	switch(t){
			case 1:
				mysetArea(5, 75, 85, 155);
				mywriteColor(white);
				break;
			case 2:
				mysetArea(86, 155, 85, 155);
				mywriteColor(cyan);			 
				break;
			case 3:
				mysetArea(165, 235, 85, 155);
				mywriteColor(green);
				break;
			case 4:
				mysetArea(5, 75, 165, 235);
				mywriteColor(blue);
				break;
			case 5:
				mysetArea(86, 155, 165, 235);
				mywriteColor(magenta);
				break;
			case 6:
				mysetArea(165, 235, 165, 235);
				mywriteColor(orange);
				break;
			case 7:
				mysetArea(5, 75, 245, 315);
				mywriteColor(yellow);
				break;
			case 8:
				mysetArea(86, 155, 245, 315);
				mywriteColor(brown);
				break;
			case 9:
				mysetArea(165, 235, 245, 315);
				mywriteColor(red);
				break;
				
		}
	GPIOE->DATA |= 0x4; // DISABLE LCD CS
}  // fill
void GPIO_INT_INIT(void) {
	// enable interrupts
	GPIOE->IM |=0x2;             // allow pin[1] to interrupt
	NVIC->IP[4] = 0x40;          // interrupt priority 2
	NVIC->ISER[0] = 1 << 4;      // Enable interrupt 4 [GPIOE]
}

void getX(int i) {
	// Temporary variables to store data as we read
	unsigned short data = 0;

	GPIOE->DATA |= 0x4; // DISABLE LCD CS
	GPIOE->DATA &= 0xFE; // TS chip select low
  sendAfterWaiting(0xD0);  // read x-coord
  data = sendAfterWaiting(0) << 5;   // sends 16-bits of 0
	data += sendAfterWaiting(0) >> 3;   // sends 16-bits of 0
	GPIOE->DATA |= 0x1; // TS chip select high
	xarray[i] = data;
}

void getY(int i) {
	// Temporary variables to store data as we read
	unsigned short data = 0;

	GPIOE->DATA |= 0x4; // DISABLE LCD CS
	GPIOE->DATA &= 0xFE; // chip select low
  sendAfterWaiting(0x90);  // read x-coord
  data = sendAfterWaiting(0) << 5;   // sends 16-bits of 0
	data += sendAfterWaiting(0) >> 3;   // sends 16-bits of 0
	GPIOE->DATA |= 0x1; // chip select high
	
	yarray[i] = data;
}


// Triggers on touchscreen press
// PE1 == 0 causes this interrupt
void GPIOE_Handler(void) {
	int x = 0;
	int i = 0;  // index
	
	
    // while PENIRQ is low, load 100 touchscreen values into array, average and get a position
	// then update position on LCD
	// GPIOE->DATA &= 0xFE;    // put CS low at start of Tx
	while ((GPIOE->DATA & 0x2) == 0x0) {  // polling PE[1], the interrupt
	  // GET TOUCHED COORDINATES for 100 cycles
	  for (i = 0; i < 100; i++) {
	    getX(i);   
	    getY(i);   
	  }

	  // Calc touched button if any
	  xtotal = 0;
      ytotal = 0;
	  for(x = 0; x < i; x++) {
		xtotal += xarray[x];
		ytotal += yarray[x];
	  }
      xtotal /= i;
      ytotal /= i;
	  // at this point xtotal and ytotal are the coordinates of a touch (not released yet)
      touch = touched_color(xtotal, ytotal);
	  // touch is 0-9, 0 = no button, 1 = white...9 = red, etc.

	  // UPDATE LCD based on current touch
	  GPIOE->DATA &= 0xFB; // ENABLE LCD CS
		if (touch > 0 && touch <= 9) {
			black1(touch);
			userPressedButton = 1;  // signal to main thread user pressed a button
		} else if (touch == 0) {
			userPressedButton = 0;  // no button pressed
		}
		

		GPIOE->DATA |= 0x4; // DISABLE LCD CS
		
		if(touch != prev_touch){
			fill(prev_touch);
		}
		prev_touch = touch;
	}  // while
	
	// we let go already
	fill(touch);
	
	GPIOE->ICR |= 0x2;    // clear interrupt on pin [1]
}  // Handler

// Reads EE prom 0x00 offset value and returns it
int readEEPROM(void) {
  int value;
  int a;  // loop variable
  EEPROM->EEOFFSET = 0x0;     
  value =  EEPROM->EERDWR;     // Read what is in the EEPROM
  for(a = 0; a < 10; a++);       // wait 6 clock cycles
  while(EEPROM->EEDONE &= 0x01);  // Wait until EEDONE[0] == 0 (EEPROM is not busy)
  return value;
}

// EEPROM write
void writeEEPROM(int value){
	EEPROM->EERDWR = value;  // works!
	while(!(EEPROM->EEDONE &= 0x01));  // Wait until EEDONE[0] == 0 (EEPROM is not busy)
}

void blink(int color){
	black1(color);
	fill(color);
}

int main(void)
{
	unsigned int i;  // index variable
	int seqLength = 3;     // random sequence length
	int sequence[50];      // highly doubt someone could get 50
	int gameOver = 0;
	unsigned int score;
	
	unsigned int temp;
	
	// initialize sequences
	for(i = 0; i < 50; i++) {
		sequence[i] = 0;
	}
	INIT_PLL();
	GPIO_INIT();
	INIT_SSI0();
    GPIO_INT_INIT();  // Enable interrupts
	EEPROM_INIT();
	INIT_I2C();        
	SysTick->CTRL = 0;  // disable timer
	SysTick->LOAD = 9;  // timer value from 0 to 9
	SysTick->CTRL = 1;  // start counting
	
	//writeEEPROM(0);  // delete me temporary  used to reset high score if needed in testing
	
	// Enable LCD
	GPIOE->DATA &= 0xFB; // LCD CS = 0  1011  PE[2] = 0
	LCD_Init();
	
	// Draw Initial screen
	mysetArea(0, 239, 0, 319);
    mywriteColor(black);	
    mysetArea(5, 75, 85, 155);
    mywriteColor(white);
    mysetArea(86, 155, 85, 155);
    mywriteColor(cyan);
    mysetArea(165, 235, 85, 155);
    mywriteColor(green);
    mysetArea(5, 75, 165, 235);
    mywriteColor(blue);
    mysetArea(86, 155, 165, 235);
    mywriteColor(magenta);
    mysetArea(165, 235, 165, 235);
    mywriteColor(orange);
    mysetArea(5, 75, 245, 315);
    mywriteColor(yellow);
    mysetArea(86, 155, 245, 315);
    mywriteColor(brown);
    mysetArea(165, 235, 245, 315);
    mywriteColor(red);

    printHighScoreText();
	printScore(readEEPROM());
	
	// START GAME
	// generate initial random sequence
	score = 0;
	srand(SysTick->VAL);
	for(i = 0; i < 2; i++) {
      sequence[i] = ((rand()%9) + 1);
    };
	seqLength = i;  // initially is 2, as main game loop will add to sequence by 1
	  
	while(!gameOver) {
	  // increase sequence length
      sequence[seqLength] = ((rand()%9) + 1);
      seqLength++;
		
      // computer turn
	  for(i = 0; i < seqLength; i++) {
        blink(sequence[i]);
	  }

	  // user turn
	  i = 0;  // length of user sequence input
	  
	  
	  // get user sequence
	  // touch global var gets updated every press of touchscreen via separate interrupt
	  // we use a semaphore in the ISR, userPressedButton, to signal to this main thread
	  // that a user has pressed a valid button
	
	  do {
		  // get a button pressed
		  if (userPressedButton == 1) {
			  if (sequence[i] != touch) {
 				  // did not match expected sequence, game over
				  gameOver = 1;
				  break;
			  } else if (sequence[i] == touch) {
				  // matched, continue to next button
				  // did we set high score of this round this time playing (not EEprom high score)
				  if (i >= score) {
					  score = i+1;
				  }
				  i++;
				  
			  }
			  
			  userPressedButton = 0;    // reset flag, ISR will set again when another button is pressed
		  }
			
	  }  while(i < seqLength);  // we will run through this at least 3 times
  }
	
    // game over animation
    gameOverAnimate();

	// game over
    temp = readEEPROM();
	if (score > temp) {
    //if (score >= 1) {
	  writeEEPROM(score);
	  printScore(score);
	}
	
	// Testing speaker
	for (i = 0; i < 4000; i++) {
	I2C0->MSA = 0x62 << 1;                    // LSB = 0 means Master writes
    I2C0->MDR = (sine_array[i%40] >> 8)&0x0F;
    I2C0->MCS = 0x00000003;                   // Start and Run     
    while(I2C0->MCS_I2C0_ALT & 0x00000001) {};  //wait
    I2C0->MDR = sine_array[i%40] & 0xFF;
    I2C0->MCS = 5;                            // Stop 
    while(I2C0->MCS_I2C0_ALT & 0x00000001) {};  //wait
	}
    
	
  GPIOE->DATA |= 0x4; // LCD CS = 1  // 0100  setting PE[2] = 1
  while(1);

}
